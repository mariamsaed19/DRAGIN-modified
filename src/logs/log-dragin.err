INFO:faiss.loader:Loading faiss.
INFO:faiss.loader:Successfully loaded faiss.
/root/miniconda3/envs/dragin/lib/python3.10/site-packages/torch/_utils.py:831: UserWarning: TypedStorage is deprecated. It will be removed in the future and UntypedStorage will be the only storage class. This should only matter to you if you are using storages directly.  To access UntypedStorage directly, use tensor.untyped_storage() instead of tensor.storage()
  return self.fget.__get__(instance, owner)()
Some weights of the model checkpoint at /root/.camel_tools/data/disambig_bert_unfactored/msa were not used when initializing BertForTokenClassification: ['bert.pooler.dense.bias', 'bert.pooler.dense.weight']
- This IS expected if you are initializing BertForTokenClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForTokenClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
INFO:__main__:Namespace(model_name_or_path='/scratch/mariam.saeed/side/advanced-nlp/models/aya-8bit', method='dragin', dataset='arabicaqa', data_path='/scratch/mariam.saeed/side/advanced-nlp/ArabicaQA', fewshot=0, sample=50, shuffle=False, generate_max_length=1024, query_formulation='real_words', retrieve_keep_top_k=35, output_dir='../result/aya-chat-arabicaqa-dragin', retriever='BM25', es_index_name='wiki_ar', retrieve_topk=3, hallucination_threshold=1.6, check_real_words=True, use_counter=True, config_path='../config/aya-expanse-quantized/ArabicaQA/DRAGIN.json')
INFO:__main__:output dir: ../result/aya-chat-arabicaqa-dragin/6
INFO:data:Loading ArabicaQA from /scratch/mariam.saeed/side/advanced-nlp/ArabicaQA
  0%|          | 0/12715 [00:00<?, ?it/s]100%|██████████| 12715/12715 [00:00<00:00, 2482570.31it/s]
Map:   0%|          | 0/12715 [00:00<?, ? examples/s]Map:  29%|██▉       | 3676/12715 [00:00<00:00, 36619.03 examples/s]Map:  58%|█████▊    | 7438/12715 [00:00<00:00, 37200.99 examples/s]Map:  88%|████████▊ | 11188/12715 [00:00<00:00, 37333.51 examples/s]Map: 100%|██████████| 12715/12715 [00:00<00:00, 37207.10 examples/s]
INFO:generate:Loading model from /scratch/mariam.saeed/side/advanced-nlp/models/aya-8bit
Unused kwargs: ['_load_in_4bit', '_load_in_8bit', 'quant_method']. These kwargs are not used in <class 'transformers.utils.quantization_config.BitsAndBytesConfig'>.
INFO:accelerate.utils.modeling:We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:02<00:02,  2.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  2.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  2.45s/it]
INFO:root:Activating Elasticsearch....
INFO:root:Elastic Search Credentials: {'hostname': 'localhost', 'index_name': 'wiki_ar', 'keys': {'title': 'title', 'body': 'txt'}, 'timeout': 100, 'retry_on_timeout': True, 'maxsize': 24, 'number_of_shards': 1, 'language': 'arabic'}
INFO:__main__:start inference
  0%|          | 0/50 [00:00<?, ?it/s]From v4.47 onwards, when a model cache is to be returned, `generate` will return a `Cache` instance instead by default (as opposed to the legacy tuple of tuples format). If you want to keep returning the legacy format, please set `return_legacy_cache=True`.
CohereModel is using CohereSdpaAttention, but `torch.nn.functional.scaled_dot_product_attention` does not support `output_attentions=True`. Falling back to the manual attention implementation, but specifying the manual implementation will be required from Transformers version v5.0.0 onwards. This warning can be removed using the argument `attn_implementation="eager"` when loading the model.
The attention layers in this model are transitioning from computing the RoPE embeddings internally through `position_ids` (2D tensor with the indexes of the tokens), to using externally computed `position_embeddings` (Tuple of tensors, containing cos and sin). In v4.46 `position_ids` will be removed and `position_embeddings` will be mandatory.
/root/miniconda3/envs/dragin/lib/python3.10/site-packages/elasticsearch/connection/base.py:190: ElasticsearchDeprecationWarning: Elasticsearch built-in security features are not enabled. Without authentication, your cluster could be accessible to anyone. See https://www.elastic.co/guide/en/elasticsearch/reference/7.17/security-minimal-setup.html to enable security.
  warnings.warn(message, category=ElasticsearchDeprecationWarning)
  2%|▏         | 1/50 [00:47<38:36, 47.27s/it]  4%|▍         | 2/50 [01:47<43:51, 54.83s/it]  6%|▌         | 3/50 [02:13<32:45, 41.81s/it]This is a friendly reminder - the current text generation call will exceed the model's predefined maximum length (8192). Depending on the model, you may observe exceptions, performance degradation, or nothing at all.
  8%|▊         | 4/50 [04:57<1:08:53, 89.85s/it] 10%|█         | 5/50 [05:46<56:23, 75.19s/it]   12%|█▏        | 6/50 [06:48<51:50, 70.69s/it] 14%|█▍        | 7/50 [08:28<57:38, 80.43s/it] 16%|█▌        | 8/50 [08:50<43:15, 61.81s/it] 18%|█▊        | 9/50 [09:26<36:38, 53.63s/it] 20%|██        | 10/50 [09:30<25:32, 38.31s/it] 22%|██▏       | 11/50 [09:41<19:29, 29.98s/it] 24%|██▍       | 12/50 [09:46<14:14, 22.48s/it] 26%|██▌       | 13/50 [09:56<11:32, 18.73s/it] 28%|██▊       | 14/50 [10:06<09:33, 15.93s/it] 30%|███       | 15/50 [10:44<13:07, 22.49s/it] 32%|███▏      | 16/50 [12:03<22:28, 39.66s/it] 34%|███▍      | 17/50 [12:24<18:46, 34.14s/it] 36%|███▌      | 18/50 [12:49<16:40, 31.28s/it] 38%|███▊      | 19/50 [13:03<13:29, 26.11s/it] 40%|████      | 20/50 [13:05<09:25, 18.86s/it] 42%|████▏     | 21/50 [13:25<09:19, 19.28s/it] 44%|████▍     | 22/50 [13:40<08:22, 17.95s/it] 46%|████▌     | 23/50 [13:57<07:58, 17.73s/it] 48%|████▊     | 24/50 [14:22<08:34, 19.78s/it] 50%|█████     | 25/50 [14:34<07:13, 17.33s/it] 52%|█████▏    | 26/50 [14:51<06:54, 17.28s/it] 54%|█████▍    | 27/50 [15:35<09:40, 25.25s/it] 56%|█████▌    | 28/50 [16:14<10:51, 29.62s/it] 58%|█████▊    | 29/50 [17:07<12:48, 36.57s/it] 60%|██████    | 30/50 [18:22<16:01, 48.10s/it] 62%|██████▏   | 31/50 [18:40<12:19, 38.94s/it] 64%|██████▍   | 32/50 [19:04<10:21, 34.50s/it] 66%|██████▌   | 33/50 [20:10<12:25, 43.85s/it] 68%|██████▊   | 34/50 [21:15<13:26, 50.41s/it] 70%|███████   | 35/50 [21:27<09:43, 38.90s/it] 72%|███████▏  | 36/50 [22:19<09:59, 42.80s/it] 74%|███████▍  | 37/50 [22:28<07:02, 32.53s/it] 76%|███████▌  | 38/50 [23:34<08:31, 42.63s/it] 78%|███████▊  | 39/50 [24:15<07:45, 42.28s/it] 80%|████████  | 40/50 [25:01<07:12, 43.26s/it] 82%|████████▏ | 41/50 [25:14<05:06, 34.08s/it] 84%|████████▍ | 42/50 [25:35<04:02, 30.34s/it] 86%|████████▌ | 43/50 [26:56<05:18, 45.52s/it] 88%|████████▊ | 44/50 [27:07<03:30, 35.04s/it] 90%|█████████ | 45/50 [27:34<02:43, 32.65s/it] 92%|█████████▏| 46/50 [28:23<02:30, 37.58s/it] 94%|█████████▍| 47/50 [28:35<01:30, 30.05s/it] 96%|█████████▌| 48/50 [28:56<00:54, 27.23s/it] 98%|█████████▊| 49/50 [29:06<00:22, 22.03s/it]100%|██████████| 50/50 [29:24<00:00, 20.78s/it]100%|██████████| 50/50 [29:24<00:00, 35.29s/it]
